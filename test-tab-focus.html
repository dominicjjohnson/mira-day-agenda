<!DOCTYPE html>
<html>
<head>
    <title>MyDiary Tab Test</title>
    <style>
        .tab-container {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
        }
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ccc;
        }
        .tab-button {
            padding: 10px 20px;
            background: #f5f5f5;
            border: 1px solid #ccc;
            border-bottom: none;
            cursor: pointer;
            margin-right: 2px;
        }
        .tab-button.active {
            background: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
            background: white;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>MyDiary Tab Focus Test</h1>
    
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab('tab1')">General Info</button>
            <button class="tab-button" onclick="showTab('tab2')">My Diary</button>
            <button class="tab-button" onclick="showTab('tab3')">Other Content</button>
        </div>
        
        <div id="tab1" class="tab-content active">
            <h3>General Information</h3>
            <p>This is some general content. Switch to the "My Diary" tab to test the diary functionality.</p>
        </div>
        
        <div id="tab2" class="tab-content">
            <h3>My Personal Agenda</h3>
            
            <!-- Simulate WordPress shortcode output with enhanced structure -->
            <div class="my-diary-container my-diary-grid">
                <div class="my-diary-header">
                    <h3 class="my-diary-title">My Personal Agenda</h3>
                    <button class="my-diary-refresh-btn" title="Refresh diary" onclick="refreshMyDiary();">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 4v6h-6M1 20v-6h6M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.64A9 9 0 0 1 3.51 15"/>
                        </svg>
                    </button>
                </div>
                
                <div id="my-diary-sessions">
                    <div class="my-diary-empty" style="display: block;">
                        <p class="empty-message">Your diary is empty. Add sessions from the agenda to see them here.</p>
                    </div>
                    <div class="my-diary-content" style="display: none;"></div>
                </div>
            </div>
            
            <!-- Test controls -->
            <div style="margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 5px;">
                <h4>Test Controls</h4>
                <button onclick="addTestSession('2025-08-06', 'Day 1')">Add Day 1 Session</button>
                <button onclick="addTestSession('2025-08-07', 'Day 2')">Add Day 2 Session</button>
                <button onclick="addTestSession('2025-08-08', 'Day 3')">Add Day 3 Session</button>
                <button onclick="clearDiary()">Clear Diary</button>
                <button onclick="showCookieContent()">Show Cookie Content</button>
                <button onclick="testModalDisplay()">Test Modal Display</button>
                <div id="cookie-display" style="margin-top: 10px; font-family: monospace; font-size: 12px;"></div>
            </div>
        </div>
        
        <div id="tab3" class="tab-content">
            <h3>Other Content</h3>
            <p>This is other content to demonstrate tab switching.</p>
        </div>
    </div>

    <script>
        // Tab switching function
        function showTab(tabId) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            
            // If switching to diary tab, trigger refresh
            if (tabId === 'tab2') {
                console.log('Switched to diary tab - triggering refresh');
                setTimeout(function() {
                    if (typeof window.refreshMyDiary === 'function') {
                        window.refreshMyDiary();
                    } else if (typeof window.populateMyDiary === 'function') {
                        window.populateMyDiary({
                            style: 'grid',
                            showDetails: true,
                            showRemoveButtons: true,
                            showEmptyMessage: true
                        });
                    }
                }, 100);
            }
        }

        // Cookie management functions (simplified versions)
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                let date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        function getCookie(name) {
            let nameEQ = name + "=";
            let ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        // Test functions
        function addTestSession(date, dayName) {
            date = date || '2025-08-06';
            dayName = dayName || 'Day 1';
            
            let diary = getCookie('AddToDiary');
            let sessions = [];
            if (diary) {
                try {
                    sessions = JSON.parse(diary);
                } catch (e) {
                    sessions = [];
                }
            }
            
            // Add a test session ID
            const testId = 'test_' + Date.now();
            sessions.push(testId);
            
            setCookie('AddToDiary', JSON.stringify(sessions), 30);
            showCookieContent();
            
            // Create mock session data for demonstration
            if (typeof window.mockSessionData === 'undefined') {
                window.mockSessionData = {};
            }
            
            window.mockSessionData[testId] = {
                id: testId,
                title: `Sample Session for ${dayName}`,
                content: `<p>This is a detailed description of the session for ${dayName}. This session covers important topics and provides valuable insights.</p><p>Join us for an informative session that will enhance your knowledge and skills.</p>`,
                content_plain: `This is a detailed description of the session for ${dayName}. This session covers important topics and provides valuable insights. Join us for an informative session that will enhance your knowledge and skills.`,
                time: getRandomTime(),
                date: date,
                track: 'Track ' + Math.ceil(Math.random() * 4),
                speakers: 'Dr. Jane Smith, Prof. John Doe',
                permalink: '#'
            };
            
            // Trigger refresh
            if (typeof window.refreshMyDiary === 'function') {
                window.refreshMyDiary();
            }
        }

        function getRandomTime() {
            const hours = [9, 10, 11, 14, 15, 16];
            const hour = hours[Math.floor(Math.random() * hours.length)];
            const minute = Math.random() > 0.5 ? '00' : '30';
            const endHour = hour + 1;
            return `${hour}:${minute} - ${endHour}:${minute}`;
        }

        function clearDiary() {
            setCookie('AddToDiary', '[]', 30);
            window.mockSessionData = {};
            showCookieContent();
            
            // Trigger refresh
            if (typeof window.refreshMyDiary === 'function') {
                window.refreshMyDiary();
            }
        }

        function showCookieContent() {
            const diary = getCookie('AddToDiary');
            document.getElementById('cookie-display').innerHTML = 
                'AddToDiary Cookie: ' + (diary || 'Not set');
        }

        function testModalDisplay() {
            // Create a test modal to verify styling
            const modalHtml = `
            <div id="test-modal" class="modal diary-modal" style="display:block;position:fixed;z-index:9999;left:0;top:0;width:100vw;height:100vh;background:rgba(0,0,0,0.5);">
                <div class="modal-content" style="position:relative;background-color:#fefefe;margin:5% auto;padding:0;border:1px solid #888;width:80%;max-width:700px;border-radius:8px;box-shadow:0 4px 6px rgba(0,0,0,0.1);">
                    <span class="close-modal" onclick="closeTestModal()" style="position:absolute;top:10px;right:15px;font-size:1.5em;cursor:pointer;z-index:10000;">&times;</span>
                    <div class="modal-body" style="margin:20px;padding-right:30px;">
                        <div class="modal-session-title">Test Session Modal</div>
                        <div class="modal-session-time"><strong>Time:</strong> 10:00 - 11:00 | <strong>Track:</strong> Track 1</div>
                        <div class="modal-session-content">
                            <p>This is a test modal to verify the styling and functionality.</p>
                            <p>The modal should display properly with all styling applied.</p>
                        </div>
                        <div class="modal-session-speakers"><strong>Speakers:</strong> Test Speaker 1, Test Speaker 2</div>
                    </div>
                </div>
            </div>`;
            
            document.body.insertAdjacentHTML('beforeend', modalHtml);
        }

        function closeTestModal() {
            const modal = document.getElementById('test-modal');
            if (modal) {
                modal.remove();
            }
        }

        // Mock refresh function if the real one isn't loaded
        if (typeof window.refreshMyDiary === 'undefined') {
            window.refreshMyDiary = function() {
                console.log('Mock refresh function called');
                alert('Mock refresh triggered! In real WordPress, this would refresh the diary.');
            };
        }

        // Initial cookie display
        document.addEventListener('DOMContentLoaded', function() {
            showCookieContent();
        });
    </script>

    <!-- Load the actual MyDiary CSS for styling -->
    <link rel="stylesheet" href="./assets/css/mydiary.css">
</body>
</html>
