<!DOCTYPE html>
<html>
<head>
    <title>MyDiary Tab Test</title>
    <style>
        .tab-container {
            width: 100%;
            max-width: 800px;
            margin: 20px auto;
        }
        .tab-buttons {
            display: flex;
            border-bottom: 1px solid #ccc;
        }
        .tab-button {
            padding: 10px 20px;
            background: #f5f5f5;
            border: 1px solid #ccc;
            border-bottom: none;
            cursor: pointer;
            margin-right: 2px;
        }
        .tab-button.active {
            background: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
            padding: 20px;
            border: 1px solid #ccc;
            border-top: none;
            background: white;
        }
        .tab-content.active {
            display: block;
        }
    </style>
</head>
<body>
    <h1>MyDiary Tab Focus Test</h1>
    
    <div class="tab-container">
        <div class="tab-buttons">
            <button class="tab-button active" onclick="showTab('tab1')">General Info</button>
            <button class="tab-button" onclick="showTab('tab2')">My Diary</button>
            <button class="tab-button" onclick="showTab('tab3')">Other Content</button>
        </div>
        
        <div id="tab1" class="tab-content active">
            <h3>General Information</h3>
            <p>This is some general content. Switch to the "My Diary" tab to test the diary functionality.</p>
        </div>
        
        <div id="tab2" class="tab-content">
            <h3>My Personal Agenda</h3>
            
            <!-- Simulate WordPress shortcode output -->
            <div class="my-diary-container my-diary-grid">
                <div class="my-diary-header">
                    <h3 class="my-diary-title">My Personal Agenda</h3>
                    <button class="my-diary-refresh-btn" title="Refresh diary" onclick="refreshMyDiary();">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M23 4v6h-6M1 20v-6h6M20.49 9A9 9 0 0 0 5.64 5.64L1 10m22 4l-4.64 4.64A9 9 0 0 1 3.51 15"/>
                        </svg>
                    </button>
                </div>
                
                <div id="my-diary-sessions">
                    <div class="my-diary-empty" style="display: block;">
                        <p class="empty-message">Your diary is empty. Add sessions from the agenda to see them here.</p>
                    </div>
                    <div class="my-diary-content" style="display: none;"></div>
                </div>
            </div>
            
            <!-- Test controls -->
            <div style="margin-top: 20px; padding: 15px; background: #f0f0f0; border-radius: 5px;">
                <h4>Test Controls</h4>
                <button onclick="addTestSession()">Add Test Session to Cookie</button>
                <button onclick="clearDiary()">Clear Diary</button>
                <button onclick="showCookieContent()">Show Cookie Content</button>
                <div id="cookie-display" style="margin-top: 10px; font-family: monospace; font-size: 12px;"></div>
            </div>
        </div>
        
        <div id="tab3" class="tab-content">
            <h3>Other Content</h3>
            <p>This is other content to demonstrate tab switching.</p>
        </div>
    </div>

    <script>
        // Tab switching function
        function showTab(tabId) {
            // Hide all tabs
            const tabs = document.querySelectorAll('.tab-content');
            const buttons = document.querySelectorAll('.tab-button');
            
            tabs.forEach(tab => tab.classList.remove('active'));
            buttons.forEach(button => button.classList.remove('active'));
            
            // Show selected tab
            document.getElementById(tabId).classList.add('active');
            event.target.classList.add('active');
            
            // If switching to diary tab, trigger refresh
            if (tabId === 'tab2') {
                console.log('Switched to diary tab - triggering refresh');
                setTimeout(function() {
                    if (typeof window.refreshMyDiary === 'function') {
                        window.refreshMyDiary();
                    } else if (typeof window.populateMyDiary === 'function') {
                        window.populateMyDiary({
                            style: 'grid',
                            showDetails: true,
                            showRemoveButtons: true,
                            showEmptyMessage: true
                        });
                    }
                }, 100);
            }
        }

        // Cookie management functions (simplified versions)
        function setCookie(name, value, days) {
            let expires = "";
            if (days) {
                let date = new Date();
                date.setTime(date.getTime() + (days * 24 * 60 * 60 * 1000));
                expires = "; expires=" + date.toUTCString();
            }
            document.cookie = name + "=" + (value || "") + expires + "; path=/";
        }

        function getCookie(name) {
            let nameEQ = name + "=";
            let ca = document.cookie.split(';');
            for (let i = 0; i < ca.length; i++) {
                let c = ca[i];
                while (c.charAt(0) === ' ') c = c.substring(1, c.length);
                if (c.indexOf(nameEQ) === 0) return c.substring(nameEQ.length, c.length);
            }
            return null;
        }

        // Test functions
        function addTestSession() {
            let diary = getCookie('AddToDiary');
            let sessions = [];
            if (diary) {
                try {
                    sessions = JSON.parse(diary);
                } catch (e) {
                    sessions = [];
                }
            }
            
            // Add a test session ID
            const testId = 'test_' + Date.now();
            sessions.push(testId);
            
            setCookie('AddToDiary', JSON.stringify(sessions), 30);
            showCookieContent();
            
            // Trigger refresh
            if (typeof window.refreshMyDiary === 'function') {
                window.refreshMyDiary();
            }
        }

        function clearDiary() {
            setCookie('AddToDiary', '[]', 30);
            showCookieContent();
            
            // Trigger refresh
            if (typeof window.refreshMyDiary === 'function') {
                window.refreshMyDiary();
            }
        }

        function showCookieContent() {
            const diary = getCookie('AddToDiary');
            document.getElementById('cookie-display').innerHTML = 
                'AddToDiary Cookie: ' + (diary || 'Not set');
        }

        // Mock refresh function if the real one isn't loaded
        if (typeof window.refreshMyDiary === 'undefined') {
            window.refreshMyDiary = function() {
                console.log('Mock refresh function called');
                alert('Mock refresh triggered! In real WordPress, this would refresh the diary.');
            };
        }

        // Initial cookie display
        document.addEventListener('DOMContentLoaded', function() {
            showCookieContent();
        });
    </script>

    <!-- Load the actual MyDiary CSS for styling -->
    <link rel="stylesheet" href="./assets/css/mydiary.css">
</body>
</html>
