<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MyDiary Functionality Test</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .test-container {
            background: white;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        .seminar-block {
            border: 1px solid #ddd;
            padding: 15px;
            margin: 10px 0;
            border-radius: 4px;
            background: #fafafa;
        }
        .seminar-title {
            font-weight: bold;
            font-size: 16px;
            margin-bottom: 8px;
        }
        .seminar-time {
            color: #666;
            font-size: 14px;
            margin-bottom: 8px;
        }
        .debug-info {
            background: #e8f4f8;
            padding: 15px;
            border-radius: 4px;
            font-family: monospace;
            font-size: 12px;
        }
        .controls {
            margin: 20px 0;
        }
        .controls button {
            margin-right: 10px;
            padding: 8px 16px;
            background: #007cba;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .controls button:hover {
            background: #005a87;
        }
    </style>
    <!-- Include the MyDiary CSS -->
    <link rel="stylesheet" href="assets/css/mydiary.css">
</head>
<body>
    <h1>MyDiary Functionality Test</h1>
    
    <div class="test-container">
        <h2>Test Seminars</h2>
        
        <div class="seminar-block">
            <div class="seminar-title">Opening Keynote: Future of Technology</div>
            <div class="seminar-time">09:00 - 10:00</div>
            <p>Join us for an inspiring keynote about emerging technologies.</p>
            <div class="mydiary-container">
                <button class="mydiary-btn mydiary-add" 
                        data-seminar-id="123" 
                        type="button" 
                        title="Click to add to diary">
                    Add to MyDiary
                </button>
            </div>
        </div>

        <div class="seminar-block">
            <div class="seminar-title">AI in Healthcare</div>
            <div class="seminar-time">10:30 - 11:30</div>
            <p>Exploring the applications of artificial intelligence in medical practice.</p>
            <div class="mydiary-container">
                <button class="mydiary-btn mydiary-add" 
                        data-seminar-id="456" 
                        type="button" 
                        title="Click to add to diary">
                    Add to MyDiary
                </button>
            </div>
        </div>

        <div class="seminar-block">
            <div class="seminar-title">Sustainable Energy Solutions</div>
            <div class="seminar-time">14:00 - 15:00</div>
            <p>Discussing renewable energy technologies and implementation strategies.</p>
            <div class="mydiary-container">
                <button class="mydiary-btn mydiary-add" 
                        data-seminar-id="789" 
                        type="button" 
                        title="Click to add to diary">
                    Add to MyDiary
                </button>
            </div>
        </div>

        <div class="seminar-block">
            <div class="seminar-title">Digital Marketing Trends</div>
            <div class="seminar-time">15:30 - 16:30</div>
            <p>Latest trends and strategies in digital marketing for 2025.</p>
            <div class="mydiary-container">
                <button class="mydiary-btn mydiary-add" 
                        data-seminar-id="101112" 
                        type="button" 
                        title="Click to add to diary">
                    Add to MyDiary
                </button>
            </div>
        </div>
    </div>

    <div class="test-container">
        <h2>Test Controls</h2>
        <div class="controls">
            <button onclick="showDiaryContents()">Show Diary Contents</button>
            <button onclick="clearDiary()">Clear Diary</button>
            <button onclick="addTestItems()">Add Test Items</button>
            <button onclick="refreshButtons()">Refresh Button States</button>
        </div>
        
        <div id="debug-output" class="debug-info">
            Cookie contents will appear here...
        </div>
    </div>

    <div class="test-container">
        <h2>Testing Instructions</h2>
        <ol>
            <li><strong>Add to Diary:</strong> Click "Add to MyDiary" buttons - they should turn grey and show "In Diary"</li>
            <li><strong>Remove from Diary:</strong> Click "In Diary" buttons - they should turn yellow/orange and show "Add to MyDiary"</li>
            <li><strong>Persistence:</strong> Refresh the page - button states should be remembered</li>
            <li><strong>Debug:</strong> Use the test controls to inspect cookie contents</li>
            <li><strong>Clear:</strong> Use "Clear Diary" to reset all buttons to default state</li>
        </ol>
        
        <h3>Expected Behavior</h3>
        <ul>
            <li>✅ Buttons change color immediately when clicked</li>
            <li>✅ State persists across page refreshes</li>
            <li>✅ Multiple seminars can be added to diary</li>
            <li>✅ Individual seminars can be removed from diary</li>
            <li>✅ Cookie stores valid JSON array of seminar IDs</li>
        </ul>
    </div>

    <!-- Include the MyDiary JavaScript -->
    <script src="assets/js/mydiary.js"></script>
    
    <!-- Test utility functions -->
    <script>
        function showDiaryContents() {
            const output = document.getElementById('debug-output');
            const cookie = document.cookie.split(';').find(c => c.trim().startsWith('AddToDiary='));
            
            if (cookie) {
                const value = cookie.split('=')[1];
                try {
                    const parsed = JSON.parse(value);
                    output.innerHTML = `
                        <strong>Cookie Found:</strong><br>
                        Raw Value: ${value}<br>
                        Parsed Array: [${parsed.join(', ')}]<br>
                        Count: ${parsed.length} seminars in diary
                    `;
                } catch (e) {
                    output.innerHTML = `
                        <strong>Cookie Found (Invalid JSON):</strong><br>
                        Raw Value: ${value}<br>
                        Error: ${e.message}
                    `;
                }
            } else {
                output.innerHTML = '<strong>No AddToDiary cookie found</strong>';
            }
        }

        function clearDiary() {
            document.cookie = 'AddToDiary=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;';
            // Trigger reinitialization
            if (window.debugMyDiary) {
                location.reload();
            }
            showDiaryContents();
        }

        function addTestItems() {
            const testItems = ['123', '456'];
            document.cookie = `AddToDiary=${JSON.stringify(testItems)}; path=/; max-age=${30 * 24 * 60 * 60}`;
            location.reload();
        }

        function refreshButtons() {
            location.reload();
        }

        // Show initial state
        setTimeout(showDiaryContents, 500);
    </script>
</body>
</html>
